<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta2/css/all.min.css" integrity="sha512-YWzhKL2whUzgiheMoBFwW8CKV4qpHQAEuvilg9FAn5VJUDwKZZxkJNuGM4XkWuk94WCrrwslk8yWNGmY1EduTA==" crossorigin="anonymous" referrerpolicy="no-referrer"
        />
        <link href="./assets/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.14.0-beta2/css/bootstrap-select.min.css" integrity="sha512-mR/b5Y7FRsKqrYZou7uysnOdCIJib/7r5QeJMFvLNHNhtye3xJp1TdJVPLtetkukFn227nKpXD9OjUc09lx97Q==" crossorigin="anonymous"
            referrerpolicy="no-referrer" />
        <link rel="shortcut icon" href="./assets/images/pixil-saga-favicon.png" type="image/x-icon">
        <link href="./assets/css/style.css" rel="stylesheet">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/big-integer/1.6.48/BigInteger.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
        <script src="./assets/js/web3.min.js"></script>
        <script src="./assets/js/trustwallet.js"></script>
        <script src="./js/contract/arbitrum/abi.js"></script>
        <script src="./js/contract/arbitrum/config.js"></script>
        <script src="./js/data/store.js"></script>
        <script src="./js/contract/arbitrum/core.js"></script>
        <script src="./js/contract/arbitrum/base.contract.js"></script>
        <script src="./js/contract/arbitrum/data.js"></script>
        <script src="./assets/js/bootstrap.bundle.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.14.0-beta2/js/bootstrap-select.min.js" integrity="sha512-FHZVRMUW9FsXobt+ONiix6Z0tIkxvQfxtCSirkKc5Sb4TKHmqq1dZa8DphF0XqKb3ldLu/wgMa8mT6uXiLlRlw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

        <title>Pixil Saga</title>
    </head>

<body>
    <div id="app">
        <header id="header">
            <div class="header">
                <div class="container-fluid">
                    <nav class="navbar navbar-expand-lg bg-light">
                        <div class="row align-items-center flex-grow-1">
                            <div class="col-lg-2">
                                <div class="d-flex align-items-center justify-content-between">
                                    <a href="/" class="logo">
                                        <img src="/assets/images/logo-pixil.png" alt="logo" />
                                    </a>
                                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation" style="color: #fff;">
                                    <i class="fas fa-bars"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="col-lg-10">
                                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                                    <div class="row align-items-center flex-grow-1">
                                        <div class="col-lg-6">
                                            <div class="d-lg-flex align-items-center">
                                                <div class="item-link mr-30">
                                                    <a href="/index.html#list-team" class="text-decoration-none fs-16 c-4 b-600 menu-dashboard f-inter">Team</a>
                                                </div>
                                                <div class="item-link mr-30">
                                                    <a href="/index.html#quiz-to-earn" class="text-decoration-none fs-16 c-4 b-600 menu-dashboard f-inter">Quiz to Earn</a>
                                                </div>
                                                <div class="item-link mr-30">
                                                    <a href="/index.html#robot" class="text-decoration-none fs-16 c-4 b-600 menu-dashboard f-inter">Robot</a>
                                                </div>
                                                <div class="item-link mr-30">
                                                    <a href="https://garbi-protocol.gitbook.io/docs/product/garbi-game/garbi-academy-1-pixil-saga/how-to-play" target="_blank" class="text-decoration-none fs-16 c-4 b-600 menu-dashboard f-inter">How to Play</a>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-6">
                                            <div class="user-action">
                                                <div class="d-lg-flex align-items-center justify-content-end user-wallet" >
                                                    <div class="wrap-user-acct dropdown show">
                                                        <a class="text-decoration-none fs-16 c-main b-600  d-flex align-items-center" href="#" role="button">
                                                            <span class="avatar mr-8" id="pixil-saga-avatar">
                                                                <img src="/assets/images/default_avatar.png" />
                                                            </span>
                                                            
                                                            <span class="b-600 user-acct">0x00</span>
                                                        </a>
                                                        
                                                    </div>
                                                    <div class="wrap-user-btn show">
                                                        <div class="wrap-btn-connect">
                                                            <a href="#" class="btn-connect-wallet text-decoration-none fs-16 b-600 c-9 background-white border-transparent-2 py-8 px-24 border-radius-20 btn-transition d-inline-block">Connect Wallet</a>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="d-lg-flex align-items-center justify-content-end button-play-game" >
                                                    <a href=""  type="button" class="btn-play-game"  >
                                                        <span class="">Earn for Free</span>
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </nav>
                    <div class="modal-detail-wrapper">
                    </div>
                </div>
            </div>
        </header>
        <main id="main">
            <div id="buy-box">
                <div class="container-fluid">
                    <div class="step-to-join-game">
                        <h1 class="title">Create Metamask Wallet</h1>
                        <div class="step-by-step">
                            <div class="step-1 on-step">
                                <a href="/step-1.html"><span>Create Metamask Wallet</span></a>
                            </div>
                            <span><i class="fa fa-chevron-right" aria-hidden="true"></i></span>
                            <div class="step-2">
                                <a href="/step-2.html"><span>Choose your Team</span></a>
                            </div>
                            <span><i class="fa fa-chevron-right" aria-hidden="true"></i></span>
                            <div class="step-3">
                                <span>Claim your NFT</span>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="first-step">
                                <div class="d-flex align-items-center">
                                    <span class="step f-inter">Step 1</span><i class="fa-solid fa-check"></i>
                                </div>
                                <h4 class="title f-inter">
                                    Create Your Metamask Wallet
                                </h4>
                                
                                <div class="download-and-setup">
                                    <h4 class="title f-inter">Download & setup</h4>
                                    <div class="row">
                                        <div class="col-lg-6">
                                            <div class="browser-support">
                                                <p class="f-inter">Extension</p>
                                                <a href="https://metamask.io/download" target="_blank" class="d-flex"><i class="fa-solid fa-globe"></i><span class="f-inter">Browser</span></a>
                                            </div>
                                        </div>
                                        <div class="col-lg-6">
                                            <div class="mobile-support">
                                                <p class="f-inter">Mobile App</p>
                                                <a href="https://play.google.com/store/search?q=metamask+wallet&c=apps" target="_blank" class="d-flex"><i class="fa-brands fa-google-play"></i><span class="f-inter">Google Play</span></a>
                                                <a href="https://apps.apple.com/us/app/metamask-blockchain-wallet/id1438144202" target="_blank" class="d-flex"><i class="fa-brands fa-apple"></i><span class="f-inter">App Store</span></a>
                                            </div>
                                        </div>
                                    </div>            
                                    
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="second-step">
                                <div class="d-flex align-items-center">
                                    <span class="step f-inter">Step 2</span><i class="fa-solid fa-check"></i>
                                </div>
                                <h4 class="title f-inter">
                                    Connect to arbitrum nova network
                                </h4>
                                <div class="checking-network">
                                    <h4 class="title f-inter">What is Arbitrum nova for?</h4>
                                    <p class="f-inter">Benefits of using Arbitrum Nova:</p>
                                    <ul>
                                        <li class="f-inter">Low-cost blockchain transactions without expensive gas fees.</li>
                                        <li class="f-inter">Faster transaction confirmation times.</li>
                                        <li class="f-inter">Improved scalability for handling high transaction volumes.</li>
                                        <li class="f-inter">Seamless integration with existing Ethereum infrastructure.</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="button-switch-network">
                        <button type="button" class="btn-switch-network"><img src="/assets/images/switch-network.png" alt=""></button>
                        <a href="/step-2.html" class="btn-next" style="display: none;"><img src="/assets/images/btn-next.png" alt=""></a>
                        <a href="https://pixilsaga.com/play" target="_blank" class="btn-play" style="display: none;"><img src="/assets/images/play-button-bg-2.png" alt=""></a>
                    </div>
                </div>
            </div>
        </main>
        <footer id="footer" class="">
            <footer id="is-footer-copyright-group">
                <div id="footer-main" class="footer footer-main fade-in-bg" >
                    <h1 class="title fade-in">STAY CONNECTED</h1>
                    <div class="social-area fade-in">
                        <a href="https://twitter.com/PixilSaga" target="_blank" class="mr-54">
                            <img alt="tw" src="/assets/images/twiter-logo.png" >
                        </a>
                        <a href="https://t.me/garbiprotocol" target="_blank" class="mr-54">
                            <img alt="tele" src="/assets/images/telegram-logo.png" >
                        </a>
                        <a href="https://github.com/garbiprotocol" target="_blank" class="">
                            <img alt="github" src="/assets/images/github.svg" >
                        </a>
                    </div>
                    <div class="logo-footer fade-in">
                        <img src="/assets/images/logo-start-game-1.png" alt="">
                    </div>
                    <div class="menu-footer fade-in">
                        <nav class="navbar navbar-expand-lg navbar-light">
                            <ul class="navbar-nav mx-auto">
                                <li class="nav-item">
                                    <a class="nav-link f-inter" target="_blank" href="https://garbi-protocol.gitbook.io/docs/">Docs</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link f-inter" target="_blank" href="https://twitter.com/PixilSaga" rel="noopener noreferrer">#Twitter</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link f-inter" target="_blank" href="https://t.me/garbiprotocol" rel="noopener noreferrer">@Telegram</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link f-inter" target="_blank" href="https://github.com/garbiprotocol">git@</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link f-inter" href="#">Version 1.1.0</a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                    <div class="copy-right fade-in">
                        <p class="f-inter"><a href="https://garbi.io" class="f-inter" target=_blank>Garbi Protocol</a> created Pixil Saga - a decentralized blend of blockchain and gamification for adventurous gamers.</p>
                    </div>
                </div>
            </footer>
        </footer>
    </div>
</body>
    <script>
            var abiHelper = new $.ABI();
            var coreHelper = new $.Core();
            var configHelper = new $.CONFIG();
            var contractBaseHelper = new $.CONTRACTBASE();
            var storeHelper = new $.STORE();
            var chainId = 42161;
           
            $(document).ready(function () {
                abiHelper.init({});
                coreHelper.init({});
                configHelper.init({});
                storeHelper.init({});
                contractBaseHelper.init({
                    chainId
                });
                $('.fade-in-bg').addClass('active');
                // Set up an Intersection Observer
                const options = {
                  root: null,
                  rootMargin: '0px',
                  threshold: 0.5
                };

                const observer = new IntersectionObserver((entries, observer) => {
                  entries.forEach((entry) => {
                    if (entry.isIntersecting) {
                      $(entry.target).addClass('active');
                      observer.unobserve(entry.target);
                    }
                  });
                }, options);

                // Find all elements with class "fade-in"
                const elements = $('.fade-in');

                // Observe each element
                elements.each((index, element) => {
                  observer.observe(element);
                });


                let teamId ;
                let _abiGameController = abiHelper.getGameControllerABI();
                let _contractsObj = configHelper.getContracts(chainId);
                let userWallet = coreHelper.getUserAccount();
                let contractGameControllerRead = contractBaseHelper.getReadContract(_contractsObj['gameController']['contract'],_abiGameController);
                function updateAvatar(teamId) {
                    if (teamId == 0) { 
                        let src = "/assets/images/default_avatar.png" ;
                        $('#pixil-saga-avatar img').attr('src', src);
                    }
                    else {
                        let src = `/assets/images/avatar_team_Id_${teamId}.png`;
                        $('#pixil-saga-avatar img').attr('src', src);
                    }
                }
                async function IsValidNode()
                {
                    let chainId          = await GetChainId();
                    let chainIdAlowed    = 42170;
                    
                    if(chainId != chainIdAlowed) 
                    {
                        return false;
                    }
                    else {
                        contractGameControllerRead.methods.GetDataUser(userWallet).call().then(function (result) {
                            let userWallet = coreHelper.getUserAccount();
                            let userAvatarId = result.avatarId;
                            if (userAvatarId == 0) {
                                $('.second-step span.step').addClass('checked');
                                $('.second-step i.fa-check').show();
                                $('.btn-next').show();
                                $('.btn-switch-network').hide();
                            }
                            else {
                                $('.second-step span.step').addClass('checked');
                                $('.second-step i.fa-check').show();
                                $('.btn-play').show();
                                $('.btn-switch-network').hide();
                            }
                        });
                    }
                }
                async function GetChainId()
                {
                    let chainId = await web3.currentProvider.request({ method: 'eth_chainId'});

                    if(`${chainId.charAt(0)}${chainId.charAt(1)}` == '0x')
                    {
                        return parseInt(chainId.slice(2), 16);
                    }
                    else
                    {
                        return parseInt(chainId, 16);
                    }
                }
                function ConvertChainIdToHex()
                {
                    let chainIdAlowed = 42170;
                    return `0x${parseInt(chainIdAlowed, 10).toString(16)}`;

                }
                async function SwitchNetWork()
                {
                    if(window.ethereum){
                        if(await IsValidNode() == false) 
                        {
                            let provider = window.ethereum;
                            let chainId = ConvertChainIdToHex();

                            let ArbitrumNovaChain = 
                            [{ 
                                "chainId": chainId.toString(),
                                "chainName": "Arbitrum Nova",
                                "nativeCurrency": {
                                    "name": 'ETH',
                                    "symbol": 'ETH',
                                    "decimals": 18
                                },
                                "rpcUrls": ["https://nova.arbitrum.io/rpc"],
                                "blockExplorerUrls": ["https://nova.arbiscan.io"],
                            }];
                            
                            try
                            {
                                await web3.currentProvider.request({ 
                                    "method": 'wallet_addEthereumChain', 
                                    "params": ArbitrumNovaChain, 
                                });
                            }
                            catch(error)
                            {  
                                await web3.currentProvider.request(
                                {
                                    method: 'wallet_switchEthereumChain',
                                    params: [{ chainId: chainId }],
                                }); 
                            }
                        }
                    }
                }
                if(window.ethereum) {
                    $('.first-step span.step').addClass('checked');
                    $('.first-step i.fa-check').show();
                }
                $('.button-switch-network').click(function() {
                    SwitchNetWork();
                });
                IsValidNode();
                contractGameControllerRead.methods.GetDataUser(userWallet).call().then(function (result) {
                    let userWallet = coreHelper.getUserAccount();
                    if (result.avatarId == 0) {
                        $('.btn-play-game').attr('href', '/step-1.html');
                    }
                    else {
                        $('.btn-play-game').attr('target', '_blank');
                        $('.btn-play-game').attr('href', 'https://pixilsaga.com/play/');
                    }
                    let teamId = result.teamId;
                    updateAvatar(teamId);
                });
                setInterval(async function () {
                    IsValidNode();
                    let userWallet = coreHelper.getUserAccount();
                    contractGameControllerRead.methods.GetDataUser(userWallet).call().then(function (result) {
                        let userWallet = coreHelper.getUserAccount();
                        if (result.avatarId == 0) {
                            $('.btn-play-game').attr('href', '/step-1.html');
                        }
                        else {
                            $('.btn-play-game').attr('target', '_blank');
                            $('.btn-play-game').attr('href', 'https://pixilsaga.com/play/');
                        }
                        let teamId = result.teamId;              
                        updateAvatar(teamId);
                    });
                }, 3000);
            });
    </script>

</html>