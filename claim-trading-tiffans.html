<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta2/css/all.min.css" integrity="sha512-YWzhKL2whUzgiheMoBFwW8CKV4qpHQAEuvilg9FAn5VJUDwKZZxkJNuGM4XkWuk94WCrrwslk8yWNGmY1EduTA==" crossorigin="anonymous" referrerpolicy="no-referrer"
        />
        <link href="./assets/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.14.0-beta2/css/bootstrap-select.min.css" integrity="sha512-mR/b5Y7FRsKqrYZou7uysnOdCIJib/7r5QeJMFvLNHNhtye3xJp1TdJVPLtetkukFn227nKpXD9OjUc09lx97Q==" crossorigin="anonymous"
            referrerpolicy="no-referrer" />
        <link rel="shortcut icon" href="./assets/images/pixil-saga-favicon.png" type="image/x-icon">
        <link href="./assets/css/style.css" rel="stylesheet">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/big-integer/1.6.48/BigInteger.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
        <script src="./assets/js/web3.min.js"></script>
        <script src="./assets/js/trustwallet.js"></script>
        <script src="./js/contract/arbitrum/abi.js"></script>
        <script src="./js/contract/arbitrum/config.js"></script>
        <script src="./js/data/store.js"></script>
        <script src="./js/contract/arbitrum/core.js"></script>
        <script src="./js/contract/arbitrum/base.contract.js"></script>
        <script src="./js/contract/arbitrum/data.js"></script>
        <script src="./assets/js/bootstrap.bundle.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.14.0-beta2/js/bootstrap-select.min.js" integrity="sha512-FHZVRMUW9FsXobt+ONiix6Z0tIkxvQfxtCSirkKc5Sb4TKHmqq1dZa8DphF0XqKb3ldLu/wgMa8mT6uXiLlRlw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>


        <title>Pixil Saga</title>
    </head>

    <body> 
        <div id="app">
          <header id="header">
            <div class="header">
              <div class="container-fluid">
                <nav class="navbar navbar-expand-lg bg-light">                                                            
                    <div class="row align-items-center flex-grow-1">
                      <div class="col-lg-12">
                        <div class="collapse navbar-collapse" id="navbarSupportedContent">
                          <div class="row align-items-center flex-grow-1">
                            <div class="col-lg-4">
                              <div class="d-lg-flex align-items-center">
                                <div class="item-link mr-30">
                                  <a href="/" class="text-decoration-none fs-16 c-4 b-600 menu-dashboard f-inter">チーム</a>
                                </div>
                                <div class="item-link mr-30">
                                  <a href="#quiz-to-earn" class="text-decoration-none fs-16 c-4 b-600 menu-dashboard f-inter">クイズ</a>
                                </div>
                                <div class="item-link mr-30">
                                  <a href="#robot" class="text-decoration-none fs-16 c-4 b-600 menu-dashboard f-inter">ロボット</a>
                                </div>
                                <div class="item-link mr-30">
                                  <a href="https://garbi-protocol.gitbook.io/docs/product/garbi-game/garbi-academy-1-pixil-saga/how-to-play" target="_blank" class="text-decoration-none fs-16 c-4 b-600 menu-dashboard f-inter">プレイ方法</a>
                                </div>
                              </div>
                            </div>
                            <div class="col-lg-4" style="display: flex; justify-content: center;">                                                            <div class="logo" style="justify-content: center; display: flex;">
                              <a href="/">
                                  <img src="/assets/images/logo-pixil.png" width="337.5px" height="40px" alt="logo">
                              </a>
                            </div>                              
                            </div>                                
                            <div class="col-lg-4">
                                <div class="user-action">
                                    <div class="d-lg-flex align-items-center justify-content-end user-wallet" >
                                        <div class="wrap-user-acct dropdown show">
                                          <a class="text-decoration-none fs-16 c-main b-600  d-flex align-items-center" href="#" role="button">
                                            <span class="avatar mr-8" id="pixil-saga-avatar">
                                              <img src="/assets/images/default_avatar.png" />
                                            </span>
                                           
                                            <span class="b-600 user-acct">0x00</span>
                                          </a>
                                          
                                        </div>

                                        <div class="wrap-user-btn show">
                                            <div class="wrap-btn-connect">
                                              <a href="#" class="btn-connect-wallet text-decoration-none fs-16 b-600 c-9 background-white py-8 px-24 border-radius-8 btn-transition d-inline-block" style="border: 2px solid #546374;">ウォレットを接続する</a>
                                            </div>
                                        </div>
                                      </div>
                                      <div class="d-lg-flex align-items-center justify-content-end button-play-game" >
                                            <a href="/step-1.html"  type="button" class="btn-play-game"  >
                                                <span class="">無料で獲得する</span>
                                            </a>
                                      </div>
                                </div>
                            </div>
                          </div>
                        </div>
                      </div>                          
                </nav>              
                <div class="modal-detail-wrapper">
                </div>
              </div>
              <nav class="navbar navbar-expand-lg navbar-light bg-light d-lg-none">
                <button class="navbar-toggler" type="button" aria-label="Toggle navigation" style="margin-left: 16px;">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <a class="navbar-brand mx-auto" href="/">
                    <img src="/assets/images/logo-pixil.png" alt="logo" style="max-width: 100%; height: auto;">
                </a>
                <div class="collapse navbar-collapse" id="navbarSmall">
                  <ul class="navbar-nav mx-auto">
                    <li class="nav-item"><a class="nav-link text-white" href="/">チーム</a></li>
                    <li class="nav-item"><a class="nav-link text-white" href="/">クイズ</a></li>
                    <li class="nav-item"><a class="nav-link text-white" href="/">ロボット</a></li>
                    <li class="nav-item"><a class="nav-link text-white" href="#">プレイ方法</a></li>
                    <li class="nav-item">
                      <a href="#" class="btn-connect-wallet text-decoration-none fs-16 b-600 c-9 background-white py-8 px-20 border-radius-8 btn-transition d-inline-block" style="border: 2px solid #546374;">ウォレットを接続する</a>
                    </li>
                    <li class="nav-item">
                      <a class="btn btn-primary text-decoration-none fs-16 b-600 c-9 py-8 px-24 border-radius-8 btn-transition d-inline-block" style="border: 2px solid; background: #ed7510;" href="/step-1.html" id="earnForFree">無料で獲得する</a>
                    </li>
                  </ul>
                </div>
              </nav>
              
            </div>
        </header>
            <main id="main">
            <div id="buy-box" class="hero" >
                    <div class="container-fluid">
                        <div class="step-to-join-game">
                            <h1 class="title">プロフィールを作成する</h1>
                            <div class="step-by-step">
                                <div class="step-1 ">
                                    <span>チームを選択する</span>
                                </div>
                                <span><i class="fa fa-chevron-right" aria-hidden="true"></i></span>
                                <div class="step-2 on-step">
                                    <span>NFTをクレームする</span>
                                </div>
                            </div>
                        </div>
                        <h4 style="color: #7E9DB6;">ステップ２</h4>
                        <h4 class="title" style="color: #000";>NFTをクレームする</h4>                        
                        <p class="f-inter" style="color: #000; text-align: left;">Pixil Sagaでチームの専用NFTを請求し、チームスピリットを披露しましょう！チームを代表するユニークなデジタルアートを解除して、ブロックチェーンゲームの世界へのあなたのコミットメントを示します。今すぐ参加して、Pixil SagaでNFTを収集し始めましょう！</p>
                        <!-- <span class="credit-cost">Cost: 1 CyberCredit</span> -->
                        <div id="hero-1">
                            <div class="">
                                <div class="hero-info-to-claim">
                                    <div class="img" >
                                        <img src="/assets/images/Hero_Team_Id_3.png" alt="Hero 1">
                                    </div>
                                    <div class="description">
                                        <h4 class="name">トレーディングタイタンズ</h4>
                                        <p class="f-inter info" style="text-align: left;">このチームは、暗号市場での積極的な取引を通じて短期的な利益に焦点を当てています。チームのメンバーは熟練したトレーダーであり、常に最大の利益を得るために適切な時に買い物や売り物の機会を探しています。</p>
                                        <span class="price">
                                          取引手数料：9 $GRB
                                        </span>
                                    </div>
                                </div>
                                <div class="button-claim">
                                    <button type="button" class="btn-approve" style="display: none;"  >
                                        <span class="">承認</span>
                                    </button>
                                    <button type="button" class="btn-mint-hero" style=""  >
                                        <span class="buy-team-id-1">クレーム</span>
                                    </button>
                                </div>       
                            </div>
                        </div>
                        <div class="modal fade" id="claim-first-robot" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                          <div class="modal-dialog modal-dialog-centered modal-fullscreen-lg-down modal-xl">
                            <div class="modal-content">
                              <div class="modal-header">
                                <!-- <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button> -->
                              </div>
                              <div class="modal-body">
                                <div class="info-robot">
                                    <div class="img">
                                        <img src="/assets/images/Hero_Team_Id_3.png" alt="">                                        
                                    </div>
                                    <h4 class="name-hero">トレーディングタイタンズ #<span class="avatar-id"></span></h4>
                                    <div class="img-robot"  style = "">
                                        <img src="/assets/images/Robot_level_Id_0.png" alt="">
                                        <h4 class="name-robot">ロボット レベル 0</h4>
                                    </div>
                                    <div class="description">
                                        <h4 class="title">おめでとうございます！</h4>
                                        <p>NFTを受け取り、レベル0のロボットが与えられました。ゲームに入って体験してください </p>
                                    </div>
                                </div>
                              </div>
                              <div class="modal-footer">
                                <a href="https://pixilsaga.com/play/" type="button" class="btn-play-game"  >
                                </a>
                              </div>
                            </div>
                          </div>
                        </div>
                    </div> 
                </div>
            </main>
            <footer id="footer" class="">
              <footer id="is-footer-copyright-group">
                  <div id="footer-main" class="footer footer-main fade-in-bg" >
                      <h1 class="title fade-in">接続を維持する</h1>
                      <div class="social-area fade-in">                           
                          <a href="https://t.me/garbiprotocol" target="_blank" class="mr-40"> 
                              <img alt="tele" src="/assets/images/telegram-logo.svg" >
                          </a>
                          <a href="https://github.com/garbiprotocol" target="_blank" class="mr-40"> 
                              <img alt="github" src="/assets/images/github.svg" >
                          </a>
                          <a href="https://twitter.com/garbi_protocol/" target="_blank" class=""> 
                            <img alt="tw" src="/assets/images/x-logo.svg" > 
                        </a>
                      </div>
                      <div class="logo-footer fade-in">
                        <img src="/assets/images/logo-start-game-1.png" alt="">
                      </div>
                      <div class="menu-footer fade-in">
                          <nav class="navbar navbar-expand-lg navbar-light">
                              <ul class="navbar-nav mx-auto">
                                <li class="nav-item">
                                  <a class="nav-link f-inter" target="_blank" href="https://garbi-protocol.gitbook.io/docs/">書類</a>
                                </li>
                                <li class="nav-item">
                                  <a class="nav-link f-inter" target="_blank" href="https://twitter.com/garbi_protocol/" rel="noopener noreferrer">#X</a>
                                </li>
                                <li class="nav-item">
                                  <a class="nav-link f-inter" target="_blank" href="https://t.me/garbiprotocol" rel="noopener noreferrer">@Telegram</a>
                                </li>
                                <li class="nav-item">
                                  <a class="nav-link f-inter" target="_blank" href="https://github.com/garbiprotocol">git@</a>
                                </li>
                                <li class="nav-item">
                                  <a class="nav-link f-inter" href="#">バージョン1.1.0</a>
                              </li>
                              </ul>
                          </nav>
                      </div>
                      <div class="copy-right fade-in">
                        <p class="f-inter"><a href="https://garbi.io" target="_blank">ガービ・プロトコルは</a> 冒険心旺盛なゲーマー向けにブロックチェーンとゲーミフィケーションを組み合わせた分散型プラットフォームであるPixil Sagaを生み出しました。</p>
                      </div>
                   </div>
              </footer>
            </footer>
        </div>
        <div class="position-fixed top-0 end-0 p-3" style="z-index: 9999">
          <div id="send-toast" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay = "5000">
            <div class="toast-body">
              <p class="" style="margin-bottom: 0;">あなたの<a href="" target="_blank" class="transaction-hash">トランザクション</a>がブロックチェーンに送信されました。</p>
            </div>
          </div>
          <div id="confirmed-toast" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay = "5000">
            <div class="toast-body">
              <p class="" style="margin-bottom: 0;">あなたの<a href="" target="_blank" class="transaction-hash">トランザクション</a>が確認されました。</p>
            </div>
          </div>
        </div>
    </body>
    <script>
            var abiHelper = new $.ABI();
            var coreHelper = new $.Core();
            var configHelper = new $.CONFIG();
            var contractBaseHelper = new $.CONTRACTBASE();
            var storeHelper = new $.STORE();
            var chainId = 42161;
           
            $(document).ready(function () {
                abiHelper.init({});
                coreHelper.init({});
                configHelper.init({});
                storeHelper.init({});
                contractBaseHelper.init({
                    chainId
                });
                $('.fade-in-bg').addClass('active');
                // Set up an Intersection Observer
                const options = {
                  root: null,
                  rootMargin: '0px',
                  threshold: 0.5
                };

                const observer = new IntersectionObserver((entries, observer) => {
                  entries.forEach((entry) => {
                    if (entry.isIntersecting) {
                      $(entry.target).addClass('active');
                      observer.unobserve(entry.target);
                    }
                  });
                }, options);

                // Find all elements with class "fade-in"
                const elements = $('.fade-in');

                // Observe each element
                elements.each((index, element) => {
                  observer.observe(element);
                });
                let teamId ;
                let _abiGameController = abiHelper.getGameControllerABI();
                let _contractsObj = configHelper.getContracts(chainId);
                let userWallet = coreHelper.getUserAccount();
                let _abiGRB = abiHelper.getGrbABI();
                let GRBAddr = configHelper.getTokenAddressByTokenName(chainId , 'grb');
                let contractGRBRead = contractBaseHelper.getReadContract(GRBAddr,_abiGRB);
                let contractGRBWhrite = contractBaseHelper.getMainContract(GRBAddr,_abiGRB);
                let contractGameControllerWhrite = contractBaseHelper.getMainContract(_contractsObj['gameController']['contract'],_abiGameController);
                let contractGameControllerRead = contractBaseHelper.getReadContract(_contractsObj['gameController']['contract'],_abiGameController);
                function updateAvatar(teamId) {
                    if (teamId == 0) { 
                        let src = "/assets/images/default_avatar.png" ;
                        $('#pixil-saga-avatar img').attr('src', src);
                    }
                    else {
                        let src = `/assets/images/avatar_team_Id_${teamId}.png`;
                        $('#pixil-saga-avatar img').attr('src', src);
                    }
                }
                contractGameControllerRead.methods.GetDataUser(userWallet).call().then(function (result) {
                    let AvatarId = result.avatarId;
                    $('.avatar-id').text(AvatarId);
                    let userWallet = coreHelper.getUserAccount();
                    if (result.avatarId == 0) {
                        $('.btn-play-game').attr('href', '/step-1.html');
                    }
                    else {
                        $('.btn-play-game').attr('target', '_blank');
                        $('.btn-play-game').attr('href', 'https://pixilsaga.com/play/');
                    }
                    let teamId = result.teamId;
                    updateAvatar(teamId);
                });
                setInterval(function () {
                    let userWallet = coreHelper.getUserAccount();
                    contractGameControllerRead.methods.GetDataUser(userWallet).call().then(function (result) {
                        let AvatarId = result.avatarId;
                        $('.avatar-id').text(AvatarId);
                        let userWallet = coreHelper.getUserAccount();
                        if (result.avatarId == 0) {
                            $('.btn-play-game').attr('href', '/step-1.html');
                        }
                        else {
                            $('.btn-play-game').attr('target', '_blank');
                            $('.btn-play-game').attr('href', 'https://pixilsaga.com/play/');
                        }
                        let teamId = result.teamId;              
                        updateAvatar(teamId);
                    });
                }, 3000);
                $('.btn-approve').click(function () {
                    let userWallet = coreHelper.getUserAccount();
                    contractGRBWhrite.methods
                    .approve(_contractsObj['gameController']['contract'], coreHelper.getAmountAllow())
                    .send({
                        from: userWallet
                    })
                    .on('transactionHash', (hash) => {
                        $('#send-toast').show();
                        $('.transaction-hash').attr("href", "https://arbiscan.io/tx/" + hash);
                    })
                    .on('confirmation', (confirmationNumber, receipt) => {
                        $('#confirmed-toast').show();
                        $('#send-toast').hide();
                        setTimeout(function(){
                          $('#confirmed-toast').hide();
                        }, 15000);
                        contractGRBRead.methods.allowance(userWallet,_contractsObj['gameController']['contract']).call().then(function (result) {
                            if (result >= 9e18) {
                                $('.btn-approve').hide();
                            }
                        });        
                    })
                    .on('receipt', (receipt) => {
                        $('#confirmed-toast').show();
                        $('#send-toast').hide();
                        setTimeout(function(){
                          $('#confirmed-toast').hide();
                        }, 15000);
                       contractGRBRead.methods.allowance(userWallet,_contractsObj['gameController']['contract']).call().then(function (result) {
                            if (result >= 9e18) {
                                $('.btn-approve').hide();
                            }
                        });        
                    })
                    .on('error', (err, receipt) => {
                        console.log(err);
                    });

                });
                $('.btn-mint-hero').click(function () {
                    let userWallet = coreHelper.getUserAccount();
                    contractGRBRead.methods.allowance(userWallet,_contractsObj['gameController']['contract']).call().then(function (result) {
                        if (result < 9e18) {
                            $('.btn-approve').show();
                        }
                        if (result >= 9e18) {
                            contractGameControllerWhrite.methods
                            .MintHeroNFT ('3')
                            .send({
                                from: userWallet
                            })
                            .on('transactionHash', (hash) => {
                                $('#send-toast').show();
                                $('.transaction-hash').attr("href", "https://arbiscan.io/tx/" + hash);
                            })
                            .on('confirmation', (confirmationNumber, receipt) => {
                                $('#send-toast').hide();
                                $('#confirmed-toast').show();
                                setTimeout(function(){
                                  $('#confirmed-toast').hide();
                                }, 15000);
                            })
                            .on('receipt', (receipt) => {
                                $('#claim-first-robot').modal('show');
                                $('#send-toast').hide();
                                $('#confirmed-toast').show();
                                setTimeout(function(){
                                  $('#confirmed-toast').hide();
                                }, 15000);
                            })
                            .on('error', (err, receipt) => {
                                console.log(err);
                            });                      
                        }
                    });
                });
            });
    </script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var navbarToggler = document.querySelector('.navbar-toggler');
            var navbarCollapse = document.getElementById('navbarSmall');

            navbarToggler.addEventListener('click', function () {
                navbarCollapse.classList.toggle('show');
            });
        });
    </script>  
</html>