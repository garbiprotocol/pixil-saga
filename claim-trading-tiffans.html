<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta2/css/all.min.css" integrity="sha512-YWzhKL2whUzgiheMoBFwW8CKV4qpHQAEuvilg9FAn5VJUDwKZZxkJNuGM4XkWuk94WCrrwslk8yWNGmY1EduTA==" crossorigin="anonymous" referrerpolicy="no-referrer"
        />
        <link href="./assets/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.14.0-beta2/css/bootstrap-select.min.css" integrity="sha512-mR/b5Y7FRsKqrYZou7uysnOdCIJib/7r5QeJMFvLNHNhtye3xJp1TdJVPLtetkukFn227nKpXD9OjUc09lx97Q==" crossorigin="anonymous"
            referrerpolicy="no-referrer" />
        <link rel="shortcut icon" href="./assets/images/pixi-favicon.png" type="image/x-icon">
        <link href="./assets/css/style.css" rel="stylesheet">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/big-integer/1.6.48/BigInteger.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
        <script src="./assets/js/web3.min.js"></script>
        <script src="./assets/js/trustwallet.js"></script>
        <script src="./js/contract/arbitrum/abi.js"></script>
        <script src="./js/contract/arbitrum/config.js"></script>
        <script src="./js/data/store.js"></script>
        <script src="./js/contract/arbitrum/core.js"></script>
        <script src="./js/contract/arbitrum/base.contract.js"></script>
        <script src="./js/contract/arbitrum/data.js"></script>
        <script src="./assets/js/bootstrap.bundle.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.14.0-beta2/js/bootstrap-select.min.js" integrity="sha512-FHZVRMUW9FsXobt+ONiix6Z0tIkxvQfxtCSirkKc5Sb4TKHmqq1dZa8DphF0XqKb3ldLu/wgMa8mT6uXiLlRlw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script src="./assets/js/custom.js"></script>
        <script src="./assets/js/custom.menu.js"></script>


        <title>Pixil Saga</title>
    </head>

    <body> 
        <div id="app">
            <header id="header">
                <div class="header">
                  <div class="container-fluid">
                    <nav class="navbar navbar-expand-lg bg-light">
                        <div class="row align-items-center flex-grow-1">
                          <div class="col-lg-2">
                            <div class="d-flex align-items-center justify-content-between">
                              <a href="/" class="logo">
                                <img src="../assets/images/logo-pixil.png" alt="logo" />
                              </a>
                              <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                                <span class="navbar-toggler-icon"></span>
                              </button>
                            </div>
                          </div>

                          <div class="col-lg-10">
                            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                              <div class="row align-items-center flex-grow-1">
                                <div class="col-lg-5">
                                  <div class="d-lg-flex align-items-center justify-content-center">
                                    <div class="item-link mr-30">
                                      <a href="/dashboard" class="text-decoration-none fs-16 c-4 b-600 menu-dashboard f-inter">Dashboard</a>
                                    </div>
                                    <div class="item-link mr-30">
                                      <a href="" class="text-decoration-none fs-16 c-4 b-600 menu-dashboard f-inter">Swap</a>
                                    </div>
                                    <div class="item-link mr-30">
                                      <a href="" class="text-decoration-none fs-16 c-4 b-600 menu-dashboard f-inter">Earn</a>
                                    </div>
                                    <div class="item-link mr-30">
                                      <a href="" class="text-decoration-none fs-16 c-4 b-600 menu-dashboard f-inter">NFT</a>
                                    </div>
                                    <div class="item-link mr-30">
                                      <a href="" class="text-decoration-none fs-16 c-4 b-600 menu-dashboard f-inter">News</a>
                                    </div>
                                    <div class="item-link mr-30">
                                      <a href="" class="text-decoration-none fs-16 c-4 b-600 menu-dashboard f-inter">World</a>
                                    </div>
                                  </div>
                                </div>
                                <div class="col-lg-7">
                                  <div class="d-lg-flex align-items-center justify-content-end" style="width: fit-content;float: right;">
                                    <div class="wrap-user-acct dropdown show">
                                      <a class="text-decoration-none fs-16 c-main b-600 dropdown-toggle dropdown-toggle-game d-flex align-items-center" href="#" role="button" id="dropdownMenuLinkInfo" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <span class="avatar mr-8" id="pixil-saga-avatar">
                                          <img src="../assets/images/default_avatar.png" />
                                        </span>
                                       
                                        <span class="b-600 user-acct">0x00</span>
                                      </a>
                                      <div class="dropdown-menu dropdown-menu__game-info" aria-labelledby="dropdownMenuLinkInfo">
                                        <div class="mb-16">
                                          <a class="dropdown-item d-flex align-items-center justify-content-between" data-bs-toggle="modal" data-bs-target="#modalChangeAvatar" href="#">
                                            <span class="fs-14 b-600">Setting</span>
                                            <svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M9.8125 6L15.8125 12L9.8125 18" stroke="#52242A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            </svg>
                                          </a>
                                        </div>
                                        <div class="mb-16">
                                          <a class="dropdown-item d-flex align-items-center justify-content-between" href="#">
                                            <span class="fs-14 b-600">Sercurity</span>
                                            <svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M9.8125 6L15.8125 12L9.8125 18" stroke="#52242A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            </svg>
                                          </a>
                                        </div>

                                        <!-- <div class="wrap-btn-connect"><a href="#" class="btn-logout text-decoration-none fs-16 b-600 c-white background-15 border-15-2 border-btn-hover-15-2 p-8 border-radius-8 btn-transition d-inline-block w-100 text-center f-inter">Log out</a></div> -->
                                      </div>
                                    </div>

                                    <div class="wrap-user-btn show">
                                        <div class="wrap-btn-connect">
                                            <a href="#" class="btn-connect-wallet text-decoration-none fs-16 b-600 c-9 background-white border-transparent-2 py-8 px-24 border-radius-20 btn-transition d-inline-block">Connect Wallet</a>
                                        </div>
                                    </div>
                                  </div>
                                  <div class="d-lg-flex align-items-center justify-content-end button-play-game" style="width: fit-content;float: right;">
                                        <a href="" type="button" class="btn-play-game"  >
                                            <span class="">Play</span>
                                        </a>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                    </nav>
                    <div class="modal-detail-wrapper">
                    </div>
                  </div>
                </div>
            </header>
            <main id="main">
            <div id="buy-box" class="hero" >
                    <div class="container-fluid">
                        <div class="step-to-join-game">
                            <h1 class="title">Create your profile</h1>
                            <div class="step-by-step">
                                <div class="step-1 ">
                                    <span>Choose your Avatar</span>
                                </div>
                                <span><i class="fa fa-chevron-right" aria-hidden="true"></i></span>
                                <div class="step-2 on-step">
                                    <span>Claim your NFT</span>
                                </div>
                            </div>
                        </div>
                        <span>Step 2</span>
                        <h4 class="title">
                            Claim your NFT
                        </h4>
                        <p class="f-inter">Claim your team's exclusive NFT in Pixil Saga and showcase your team spirit! Unlock a unique piece of digital art that represents your team and your commitment to the world of blockchain gaming. Join us now and start collecting NFTs in Pixil Saga!</p>
                        <!-- <span class="credit-cost">Cost: 1 CyberCredit</span> -->
                        <div id="hero-1">
                            <div class="">
                                <div class="hero-info-to-claim">
                                    <div class="img" >
                                        <img src="../assets/images/Hero_Team_Id_3.png" alt="Hero 1">
                                    </div>
                                    <div class="description">
                                        <h4 class="name">Trading Titans</h4>
                                        <p class="f-inter info">This team is all about the classic strategy of holding onto their digital assets for the long term. Members of this team are patient and strategic, always thinking about the big picture and the potential future value of their investments.</p>
                                        <span class="price">
                                            Gas fee: 10 veGRB or 10 GRB
                                        </span>
                                    </div>
                                </div>
                                <p class="text-if-not-approve" style="display: none;">You need to approve GRB before Claim</p>
                                <div class="button-claim">
                                    <button type="button" class="btn-approve" style="display: none;"  >
                                        <span class="">Approve</span>
                                    </button>
                                    <button type="button" class="btn-mint-hero" style=""  >
                                        <span class="buy-team-id-1">Claim</span>
                                    </button>
                                </div>       
                            </div>
                        </div>
                        <div class="modal fade" id="claim-first-robot" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                          <div class="modal-dialog modal-dialog-centered modal-xl">
                            <div class="modal-content">
                              <div class="modal-header">
                                <!-- <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button> -->
                              </div>
                              <div class="modal-body">
                                <div class="info-robot">
                                    <div class="img" style = "left: 151px;">
                                        <img src="../assets/images/Hero_Team_Id_3.png" alt="">
                                        <h4 class="name-hero">Trading Titans#1</h4>
                                    </div>
                                    <div class="description">
                                        <h4 class="title">Congratulations!</h4>
                                        <p>You have received your first NFT Robot</p>
                                    </div>
                                </div>
                              </div>
                              <div class="modal-footer">
                                <a href="http://159.89.203.177:5055/" type="button" class="btn-play-game"  >
                                    <span class="">Play</span>
                                </a>
                              </div>
                            </div>
                          </div>
                        </div>
                    </div> 
                </div>
            </main>
            <footer id="footer">
                <footer id="is-footer-copyright-group">
                    <div id="footer-main" class="footer footer-main" >
                        <h1 class="title">STAY CONNECTED</h1>
                        <div class="social-area">
                            <a href="" target="_blank" class="mr-54"> 
                                <img alt="tw" src="../assets/images/twiter-logo.png" style="width: 64px"> 
                            </a> 
                            <a href="" target="_blank" class="mr-54"> 
                                <img alt="tele" src="../assets/images/telegram-logo.png" style="width: 64px">
                            </a>
                            <a href="" target="_blank" class=""> 
                                <img alt="gmail" src="../assets/images/gmail-logo.png" style="width: 64px">
                            </a>
                        </div>
                        <div class="logo-footer">
                            <img src="../assets/images/logo-start-game.png" alt="">
                        </div>
                        <div class="menu-footer ">
                            <nav class="navbar navbar-expand-lg navbar-light">
                                <ul class="navbar-nav mx-auto">
                                  <li class="nav-item">
                                    <a class="nav-link f-inter" href="#">CAREERS</a>
                                  </li>
                                  <li class="nav-item">
                                    <a class="nav-link f-inter" href="#">ABOUT</a>
                                  </li>
                                  <li class="nav-item">
                                    <a class="nav-link f-inter" href="#">SUPPORT</a>
                                  </li>
                                  <li class="nav-item">
                                    <a class="nav-link f-inter" href="#">CONTACT US</a>
                                  </li>
                                  <li class="nav-item">
                                    <a class="nav-link f-inter" href="#">API</a>
                                  </li>
                                </ul>
                            </nav>
                        </div>
                        <div class="copy-right">
                            <p class="f-inter">All trademarks referenced here in are the properties of their respective owners.</p>
                        </div>
                     </div>
                </footer>
            </footer>
        </div>
        <div class="position-fixed top-0 end-0 p-3" style="z-index: 11">
          <div id="send-toast" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay = "5000">
            <div class="toast-body">
              <p class="" style = "margin-bottom: 0;">Your <a href="" target="_blank" class="transaction-hash">transaction</a> is sent to the blockchain.</p>
            </div>
          </div>
          <div id="confirmed-toast" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay = "5000">
            <div class="toast-body">
              <p class="" style = "margin-bottom: 0;">Your <a href="" target="_blank" class="transaction-hash">transaction</a> is confirmed.</p>
            </div>
          </div>
        </div>
    </body>
    <script>
            var abiHelper = new $.ABI();
            var coreHelper = new $.Core();
            var configHelper = new $.CONFIG();
            var contractBaseHelper = new $.CONTRACTBASE();
            var storeHelper = new $.STORE();
            var chainId = 421613;
           
            $(document).ready(function () {
                abiHelper.init({});
                coreHelper.init({});
                configHelper.init({});
                storeHelper.init({});
                contractBaseHelper.init({
                    chainId
                });
                let teamId ;
                let _abiGameController = abiHelper.getGameControllerABI();
                let _contractsObj = configHelper.getContracts(chainId);
                let userWallet = coreHelper.getUserAccount();
                let _abiMGRB = abiHelper.getMGrbABI();
                let MGRBAddr = configHelper.getTokenAddressByTokenName(chainId , 'mgrb');
                let contractMGRBRead = contractBaseHelper.getReadContract(MGRBAddr,_abiMGRB);
                let contractMGRBWhrite = contractBaseHelper.getMainContract(MGRBAddr,_abiMGRB);
                let contractGameControllerWhrite = contractBaseHelper.getMainContract(_contractsObj['gameController']['contract'],_abiGameController);
                let contractGameControllerRead = contractBaseHelper.getReadContract(_contractsObj['gameController']['contract'],_abiGameController);
                function updateAvatar(teamId) {
                    if (teamId == 0) { 
                        let src = "../assets/images/default_avatar.png" ;
                        $('#pixil-saga-avatar img').attr('src', src);
                    }
                    else {
                        let src = `../assets/images/avatar_team_Id_${teamId}.png`;
                        $('#pixil-saga-avatar img').attr('src', src);
                    }
                }
                contractGameControllerRead.methods.GetDataUser(userWallet).call().then(function (result) {
                    let userWallet = coreHelper.getUserAccount();
                    if (result.avatarId == 0) {
                        $('.btn-play-game').attr('href', '/step-1.html');
                    }
                    else {
                        $('.btn-play-game').attr('href', 'http://159.89.203.177:5055/');
                    }
                    let teamId = result.teamId;
                    updateAvatar(teamId);
                });
                setInterval(function () {
                    let userWallet = coreHelper.getUserAccount();
                    contractGameControllerRead.methods.GetDataUser(userWallet).call().then(function (result) {
                        let userWallet = coreHelper.getUserAccount();
                        if (result.avatarId == 0) {
                            $('.btn-play-game').attr('href', '/step-1.html');
                        }
                        else {
                            $('.btn-play-game').attr('href', 'http://159.89.203.177:5055/');
                        }
                        let TeamId = result.teamId;              
                        updateAvatar(teamId);
                    });
                }, 3000);
                $('.btn-mint-hero').click(function () {
                    let userWallet = coreHelper.getUserAccount();
                    contractMGRBRead.methods.allowance(userWallet,_contractsObj['gameController']['contract']).call().then(function (result) {
                        console.log(result);
                        if (result == 0) {
                            $('.btn-approve').show();
                            $('.text-if-not-approve').show()
                        }
                        if (result != 0) {
                            contractGameControllerWhrite.methods
                            .MintHeroNFT ('3')
                            .send({
                                from: userWallet
                            })
                            .on('transactionHash', (hash) => {
                                coreHelper.showPopup('confirm-popup');
                                $('.transaction-hash').attr("href", "https://arbiscan.io/tx/" + hash);
                            })
                            .on('confirmation', (confirmationNumber, receipt) => {
                                $('#send-toast').show();
                                setTimeout(function(){
                                  $('#send-toast').hide();
                                }, 5000);
                            })
                            .on('receipt', (receipt) => {
                                $('#claim-first-robot').modal('show');
                                $('#confirmed-toast').show();
                                setTimeout(function(){
                                  $('#confirmed-toast').hide();
                                }, 5000);
                            })
                            .on('error', (err, receipt) => {
                                console.log(err);
                            });                      
                        }
                    });
                });
                $('.btn-approve').click(function () {
                    let userWallet = coreHelper.getUserAccount();
                    contractMGRBWhrite.methods
                    .approve(_contractsObj['gameController']['contract'], coreHelper.getAmountAllow())
                    .send({
                        from: userWallet
                    })
                    .on('transactionHash', (hash) => {
                        coreHelper.showPopup('confirm-popup');
                        $('.transaction-hash').attr("href", "https://arbiscan.io/tx/" + hash);
                    })
                    .on('confirmation', (confirmationNumber, receipt) => {
                        $('#send-toast').show();
                        setTimeout(function(){
                          $('#send-toast').hide();
                        }, 5000);
                    })
                    .on('receipt', (receipt) => {
                        $('.btn-approve').hide();
                        $('#confirmed-toast').show();
                        setTimeout(function(){
                          $('#confirmed-toast').hide();
                        }, 5000);
                    })
                    .on('error', (err, receipt) => {
                        console.log(err);
                    });

                });
            });
    </script>

</html>